<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */
 
class Pedido_model extends CI_Model
{
    function __construct()
    {
        parent::__construct();
    }
    
    /*
     * Get pedido by pedido_id
     */
    function get_pedido($pedido_id)
    {
        $pedido = $this->db->query("
            SELECT
                *

            FROM
                `pedido`

            WHERE
                `pedido_id` = ?
        ",array($pedido_id))->row_array();

        return $pedido;
    }
        
    /*
     * Get all pedido
     */
    function get_all_pedido()
    {
        $pedido = $this->db->query("
            SELECT
                p.*, e.estado_color, e.estado_descripcion, g.gestion_nombre, u.unidad_nombre,t.programa_nombre 

            FROM
                pedido p

            LEFT JOIN estado e on p.estado_id = e.estado_id
            LEFT JOIN gestion g on p.gestion_id = g.gestion_id
            LEFT JOIN unidad u on p.unidad_id = u.unidad_id
            LEFT JOIN programa t on p.programa_id = t.programa_id
            
            WHERE p.estado_id = 6
            ORDER BY p.pedido_id DESC 
            
        ")->result_array();

        return $pedido;
    }
        
    /*
     * function to add new pedido
     */
    function add_pedido($params)
    {
        $this->db->insert('pedido',$params);
        return $this->db->insert_id();
    }
    
    /*
     * function to update pedido
     */
    function update_pedido($pedido_id,$params)
    {
        $this->db->where('pedido_id',$pedido_id);
        return $this->db->update('pedido',$params);
    }
    
    /*
     * function to delete pedido
     */
    function delete_pedido($pedido_id)
    {
        return $this->db->delete('pedido',array('pedido_id'=>$pedido_id));
    }
    /*
     * Get all articulo parametro
     */
    function get_all_pedidoparametro($parametro, $categoria)
    {
        $pedido = $this->db->query("
            SELECT
                p.*, e.estado_color, e.estado_descripcion, e.estado_id,
                u.unidad_nombre, pr.programa_nombre, g.gestion_nombre

            FROM
                pedido p
                LEFT JOIN estado e on p.estado_id = e.estado_id
                LEFT JOIN unidad u on p.unidad_id = u.unidad_id
                LEFT JOIN programa pr on p.programa_id = pr.programa_id
                LEFT JOIN gestion g on p.gestion_id = g.gestion_id
            
            WHERE
                p.estado_id = e.estado_id
                and (p.pedido_numero like '%".$parametro."%')
                ".$categoria."
            GROUP BY
                p.pedido_id

            ORDER BY p.pedido_id
        ")->result_array();

        return $pedido;
    }
    
    /*
     * cantidad de pedidos
     */
    function get_pedido_count()
    {
        $sql = "select if(count(*)>0,count(*),0) as cantidad_pedido from pedido where estado_id = 6";
        return $this->db->query($sql)->result_array();
    }
    
    /*
     * cantidad de pedidos
     */
    function get_pedidos()
    {
        $sql = "select if(count(*)>0,count(*),0) as cantidad_pedido from pedido where estado_id = 6";
        return $this->db->query($sql)->result_array();
    }
}
